<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Recall WI ‚Äî Oficial</title>
<style>
  :root{
    --bg:#0f1114; --panel:#15181b; --muted:#9aa4ad; --accent:#00d1ff;
    --gold:#ffd700; --purple:#a44bff; --orange:#ff7b00;
    --card:#1b1f23; --glass: rgba(255,255,255,0.03); --text:#e9eef2;
    --halloween-bg-start:#12040b;
    --halloween-bg-end:#2b0810;
    --natal-bg-start:#02120a;
    --natal-bg-end:#401010;
    --aniv-bg-start:#081028;
    --aniv-bg-end:#1b0b2a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    color:var(--text); background:linear-gradient(180deg,#0b0d10,#111217);
    min-height:100vh; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    transition: background 450ms ease, color 350ms ease;
  }
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.15));border-bottom:1px solid rgba(255,255,255,0.03);position:sticky;top:0;z-index:40}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--purple));display:flex;align-items:center;justify-content:center;font-weight:900;color:#021;font-size:20px;box-shadow:0 8px 30px rgba(0,0,0,0.5)}
  nav{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .navbtn{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);cursor:pointer;font-weight:700}
  .navbtn.active{outline:2px solid var(--accent); box-shadow:0 6px 18px rgba(0,0,0,0.35)}
  .controls{display:flex;gap:8px;align-items:center}
  main{padding:20px;max-width:1180px;margin:18px auto}
  .panel{background:var(--panel);border-radius:12px;padding:16px;margin-bottom:18px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 10px 30px rgba(0,0,0,0.5)}
  .group-title{font-size:18px;color:var(--accent);margin-bottom:10px;font-weight:800}
  .small{font-size:13px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
  .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .char-name{display:flex;justify-content:space-between;align-items:center;gap:8px;cursor:pointer}
  .char-ability{display:none;margin-top:8px;padding:10px;background:rgba(0,0,0,0.06);border-radius:8px}
  .tag{padding:6px 8px;border-radius:8px;font-weight:800;font-size:12px}
  .comum{background:rgba(255,255,255,0.03);color:#ddd}
  .raro{background:rgba(0,123,255,0.06);color:var(--accent)}
  .epico{background:rgba(164,75,255,0.06);color:var(--purple)}
  .lendario{background:linear-gradient(90deg,#ffd70020,#ff9a0020);color:var(--gold)}
  .shop-line{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px}
  .old-price{text-decoration:line-through;color:#ffb3a3;margin-right:8px;font-size:13px}
  .new-price{color:var(--accent);font-weight:900}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border:1px solid rgba(255,255,255,0.03);text-align:left}
  th{background:rgba(255,255,255,0.02)}
  .hidden{display:none}
  /* secret button bottom-right */
  #secretBtn{position:fixed;right:18px;bottom:18px;width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--orange),var(--purple));display:flex;align-items:center;justify-content:center;font-weight:900;color:#021;cursor:pointer;z-index:60;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
  /* secret panel */
  #secretPanel{position:fixed;right:18px;bottom:80px;width:420px;max-width:96vw;background:var(--panel);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.03);z-index:61;display:none}
  .event-btn{padding:8px 10px;margin:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);cursor:pointer;background:transparent;color:var(--text);font-weight:800}
  .section-title{font-weight:800;margin-top:8px;color:var(--gold)}
  footer{text-align:center;padding:12px;color:var(--muted);font-size:13px}
  .btn{padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:#021;font-weight:700;cursor:pointer}
  .danger{background:#ff6b6b;color:#fff}
  .notice{font-size:13px;color:var(--muted);margin-top:8px}
  .hero-banner{border-radius:10px;padding:18px;margin-bottom:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06)); display:flex;align-items:center;justify-content:space-between;gap:12px}
  .hero-left{max-width:70%}
  .hero-title{font-size:20px;font-weight:900}
  .hero-desc{color:var(--muted);font-size:13px;margin-top:6px}
  .event-pill{padding:6px 10px;border-radius:8px;font-weight:800}
  @media (max-width:820px){ .hero-left{max-width:100%} main{padding:12px} header{flex-direction:column;gap:8px;align-items:flex-start} }
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo" id="logoBox">RW</div>
    <div>
      <h1 style="margin:0">Recall WI</h1>
      <div class="small">Tudo que voc√™ precisa saber do Recall</div>
    </div>
  </div>

  <nav aria-label="Navega√ß√£o principal">
    <button class="navbtn active" data-section="characters">Personagens</button>
    <button class="navbtn" data-section="shop">Loja</button>
    <button class="navbtn" data-section="money">Economia</button>
    <button class="navbtn" data-section="tracker">Lista secreta</button>
    <button class="navbtn" data-section="trios">Tr√≠ades</button>
    <button class="navbtn" data-section="updates">Atualiza√ß√µes</button>
  </nav>

  <div class="controls">
    <button id="themeBtn" class="navbtn">Mudar tema</button>
  </div>
</header>

<main>
  <div class="hero-banner panel">
    <div class="hero-left">
      <div class="hero-title">Recall WI ‚Äî Central</div>
      <div class="hero-desc">Personagens, loja, economia, tracker e painel secreto. Eventos comemorativos aplicam 50% OFF automaticamente apenas durante o per√≠odo do evento.</div>
    </div>
    <div style="text-align:right">
      <div id="activeEventLabel" class="event-pill" style="background:rgba(255,255,255,0.02)">Nenhum evento</div>
      <div class="notice" id="activeEventInfo"></div>
    </div>
  </div>

  <!-- Characters -->
  <section id="characters" class="panel"></section>

  <!-- Shop -->
  <section id="shop" class="panel hidden"></section>

  <!-- Money -->
  <section id="money" class="panel hidden">
    <div class="group-title">Como ganhar Essence</div>
    <div class="small">A√ß√µes e recompensas</div>
    <table style="margin-top:10px">
      <thead><tr><th>A√ß√£o</th><th>Essence</th></tr></thead>
      <tbody id="moneyTableBody"></tbody>
    </table>
  </section>

  <!-- Tracker -->
  <section id="tracker" class="panel hidden"></section>

  <!-- Trios -->
  <section id="trios" class="panel hidden">
    <div class="group-title">Tr√≠ades</div>
    <div class="small">Cada personagem pertence a uma tr√≠ade ‚Äî ??? indica vaga.</div>
    <div id="trioGrid" class="grid" style="margin-top:12px"></div>
  </section>

  <!-- Updates -->
  <section id="updates" class="panel hidden"></section>
</main>

<!-- secret button bottom-right -->
<div id="secretBtn" title="Painel secreto">üîê</div>

<!-- secret panel -->
<div id="secretPanel" role="dialog" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div style="font-weight:900">Painel Secreto</div>
    <button id="closeSecret" class="event-btn">Fechar</button>
  </div>

  <div style="margin-top:8px">
    <div class="small">Digite a senha para abrir controles:</div>
    <input id="secretPass" type="password" placeholder="Senha" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);margin-top:6px">
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="unlockBtn" class="event-btn">Desbloquear</button>
      <button id="resetEventBtn" class="event-btn">Resetar evento</button>
    </div>
  </div>

  <div id="eventControls" style="margin-top:12px;display:none">
    <div class="section-title">COMEMORA√á√ïES (50% OFF na loja de personagens)</div>
    <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px">
      <button class="event-btn" data-event="halloween">üéÉ Halloween</button>
      <button class="event-btn" data-event="natal">üéÑ Natal</button>
      <button class="event-btn" data-event="ano-novo">üéÜ Ano Novo</button>
      <button class="event-btn" data-event="aniversario">üéÇ Anivers√°rio Recall</button>
    </div>

    <div class="section-title">ESTA√á√ïES (apenas visual)</div>
    <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px">
      <button class="event-btn" data-event="verao">‚òÄÔ∏è Ver√£o</button>
      <button class="event-btn" data-event="outono">üçÇ Outono</button>
      <button class="event-btn" data-event="inverno">‚ùÑÔ∏è Inverno</button>
      <button class="event-btn" data-event="primavera">üå∏ Primavera</button>
    </div>

    <div class="section-title">EVENTOS DO LORE</div>
    <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px">
      <button class="event-btn" data-event="abyssal">üñ§ Abyssal Shadows</button>
      <button class="event-btn" data-event="ruptura">üî• Ruptura Temporal</button>
      <button class="event-btn" data-event="eclipse">üåë Eclipse Total</button>
    </div>

    <div class="section-title">MODOS EXTRAS</div>
    <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px">
      <button class="event-btn" data-event="caos">üåÄ Modo Caos</button>
      <button class="event-btn" data-event="doce">üç¨ Modo Doce</button>
      <button class="event-btn" data-event="teste">üß™ Modo Teste</button>
    </div>

    <div style="margin-top:10px" class="small">Recomenda√ß√µes de data aparecem ao passar o mouse.  
    Use <strong>Gerar index global</strong> abaixo para baixar um arquivo pronto (com o evento que voc√™ escolher for√ßado) ‚Äî depois √© s√≥ subir esse arquivo no GitHub para que o evento seja visto por todos.</div>

    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      <button id="exportGlobalBtn" class="event-btn">Gerar index global</button>
      <button id="exportGlobalPrompt" class="event-btn">Gerar index (escolher evento)</button>
    </div>
  </div>
</div>

<footer style="position:relative">Recall WI ‚Äî pain√©is de evento: comemora√ß√µes d√£o 50% OFF (somente personagens) ‚Ä¢ senha admin: BATATA</footer>

<script>
/* ---------- CONFIG ---------- */
/*
 Notes:
 - To make an event truly global for everyone, replace index.html in GitHub with a copy containing FORCE_GLOBAL_EVENT = 'halloween' (or whatever).
 - To make that easier, the secret panel includes a "Gerar index global" function that creates and downloads a copy of this file with the chosen FORCE_GLOBAL_EVENT embedded.
*/
const TRACKER_PASSWORD = "BATATA";

/* ---------- DATA ---------- */
const characters = [
  {key:"Seraphina", display:"Seraphina ‚Äî The Healer", type:"Sobrevivente", rarity:"comum", oldPrice:200, price:0, ability:"Revive 1 jogador eliminado (1x).", phraseEN:"Rise again!", phrasePT:"Levante-se de novo!"},
  {key:"Nyra", display:"Nyra ‚Äî The Swift", type:"Sobrevivente", rarity:"comum", oldPrice:200, price:0, ability:"Escapa de 1 captura (1x).", phraseEN:"Too fast for you!", phrasePT:"R√°pida demais pra voc√™!"},
  {key:"Gideon", display:"Gideon ‚Äî The Guardian", type:"Sobrevivente", rarity:"raro", oldPrice:1000, price:500, ability:"Protege algu√©m de 1 ataque (escudo 10s).", phraseEN:"Stay behind me!", phrasePT:"Fiquem atr√°s de mim!"},
  {key:"Aether", display:"Aether ‚Äî The Watcher", type:"Sobrevivente", rarity:"raro", oldPrice:1000, price:500, ability:"Pergunta ao assassino o pr√≥ximo alvo (1x).", phraseEN:"Who‚Äôs your next target?", phrasePT:"Qual √© o seu pr√≥ximo alvo?"},
  {key:"Elara", display:"Elara ‚Äî The Strategist", type:"Sobrevivente", rarity:"epico", oldPrice:1600, price:900, ability:"Pode correr duas vezes seguidas sem ser pega (1x).", phraseEN:"Double move!", phrasePT:"Movimento duplo!"},
  {key:"Orion", display:"Orion ‚Äî The Illusionist", type:"Sobrevivente", rarity:"epico", oldPrice:1700, price:950, ability:"Diz 'Illusion!' ‚Üí assassino deve perseguir outro alvo por 10s (1x).", phraseEN:"Can you catch a shadow of me?", phrasePT:"Consegue pegar s√≥ minha sombra?"},
  {key:"Liora", display:"Liora ‚Äî The Veiled", type:"Sobrevivente", rarity:"lendario", oldPrice:2600, price:1500, ability:"Faz assassino contar 8s parado (1x).", phraseEN:"Now you forget me‚Ä¶", phrasePT:"Agora voc√™ me esquece‚Ä¶"},
  {key:"Marin", display:"Marin ‚Äî The Timebinder", type:"Sobrevivente", rarity:"lendario", oldPrice:2700, price:1600, ability:"Ativa 'Time Snare': assassino N√ÉO PODE CORRER 5s (1x).", phraseEN:"Slow down, time obeys me!", phrasePT:"Diminua, o tempo me obedece!"},
  {key:"Cael", display:"Cael ‚Äî The Defier", type:"Sobrevivente", rarity:"epico", oldPrice:2200, price:1200, ability:"Ao ser alvo: assassino N√ÉO PODE ATACAR por 2s e N√ÉO PODE CORRER por 8s (1x).", phraseEN:"Your turn to run.", phrasePT:"Agora √© voc√™ quem corre."},
  {key:"Umbra", display:"Umbra ‚Äî The Shadow", type:"Assassino", rarity:"comum", oldPrice:400, price:200, ability:"Habilidade ativa somente se tentar pegar e falhar (1x).", phraseEN:"Shadow strike!", phrasePT:"Golpe das sombras!"},
  {key:"Darius", display:"Darius ‚Äî The Hunter", type:"Assassino", rarity:"raro", oldPrice:800, price:500, ability:"Marked: bloqueia habilidades do alvo por 15s (1x).", phraseEN:"Marked!", phrasePT:"Marcado!"},
  {key:"Echo", display:"Echo ‚Äî The Returned", type:"Assassino", rarity:"epico", oldPrice:1800, price:950, ability:"Anula 1 poder usado contra ele (1x).", phraseEN:"Echo!", phrasePT:"Eco!"},
  {key:"Requiem", display:"Requiem ‚Äî The Reaper", type:"Assassino", rarity:"lendario", oldPrice:3000, price:1600, ability:"Local da morte se torna letal por 15s (1x).", phraseEN:"Death remains...", phrasePT:"A morte permanece..."}
];

const moneyTable = [
  {action:"Sobrevive at√© o fim", value:"+50E"},
  {action:"Revive algu√©m", value:"+25E"},
  {action:"Usa habilidade com sucesso", value:"+20E"},
  {action:"Morre antes de 2min", value:"+10E"},
  {action:"Morre depois de 2min", value:"+30E"},
  {action:"Assassino elimina algu√©m", value:"+20E"},
  {action:"Assassino vence partida", value:"+100E"},
  {action:"Respeita as regras", value:"+5E"},
  {action:"Melhor da rodada", value:"+25E"}
];

const trios = [
  {title:"Tr√≠ade da Vida", desc:"Cura, prote√ß√£o e resili√™ncia", members:["Seraphina","Gideon","Requiem"]},
  {title:"Tr√≠ade da Mente", desc:"Observa√ß√£o, estrat√©gia e previs√£o", members:["Aether","Elara","Orion"]},
  {title:"Tr√≠ade da Velocidade", desc:"Movimento, reflexo e precis√£o", members:["Nyra","Echo","Darius"]},
  {title:"Tr√≠ade das Sombras", desc:"Engano, resist√™ncia e retribui√ß√£o (Mestre do Umbra chegando)", members:["Umbra","Liora","???"]},
  {title:"Tr√≠ade do Tempo", desc:"Controle temporal e manipula√ß√£o", members:["Marin","Cael","Orion"]}
];

const eventDefinitions = {
  "halloween": {type:"comemoracao", label:"Halloween", discount:0.5, rec:"01-10 ‚Üí 05-11"},
  "natal": {type:"comemoracao", label:"Natal", discount:0.5, rec:"15-12 ‚Üí 26-12"},
  "ano-novo": {type:"comemoracao", label:"Ano Novo", discount:0.5, rec:"27-12 ‚Üí 02-01"},
  "aniversario": {type:"comemoracao", label:"Anivers√°rio Recall (21/09)", discount:0.5, rec:"20-09 ‚Üí 22-09"},
  "verao": {type:"estacao", label:"Ver√£o", rec:"21-12 ‚Üí 20-03"},
  "outono": {type:"estacao", label:"Outono", rec:"20-03 ‚Üí 21-06"},
  "inverno": {type:"estacao", label:"Inverno", rec:"21-06 ‚Üí 22-09"},
  "primavera": {type:"estacao", label:"Primavera", rec:"22-09 ‚Üí 21-12"},
  "abyssal": {type:"evento", label:"Abyssal Shadows", rec:"Livre (lore)"},
  "ruptura": {type:"evento", label:"Ruptura Temporal", rec:"Livre (lore)"},
  "eclipse": {type:"evento", label:"Eclipse Total", rec:"Livre (lore)"},
  "caos": {type:"modo", label:"Modo Caos", rec:"Livre"},
  "doce": {type:"modo", label:"Modo Doce", rec:"Livre"},
  "teste": {type:"modo", label:"Modo Teste", rec:"Livre"}
};

/* ---------- STATE ---------- */
// activeEvent is either null or one of eventDefinitions keys.
// It's stored in localStorage for this browser. To force global for everyone you must replace index.html in repo (see export below).
let activeEvent = localStorage.getItem('recall_active_event') || null;
let forcedGlobal = null; // used only when generating export file (not active here)

/* ---------- HELPERS ---------- */
function $(sel){return document.querySelector(sel)}
function $all(sel){return Array.from(document.querySelectorAll(sel))}

/* THEME toggle (light/dark) */
$('#themeBtn').addEventListener('click', ()=>{
  const cur = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
  document.body.setAttribute('data-theme', cur);
  localStorage.setItem('recall_theme', cur);
});

/* NAV */
$all('.navbtn').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    $all('.navbtn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const sec = btn.getAttribute('data-section');
    showSection(sec);
  });
});
function showSection(id){
  ['characters','shop','money','tracker','trios','updates'].forEach(s=>{
    const el = document.getElementById(s);
    if(!el) return;
    el.classList.toggle('hidden', s !== id);
  });
  if(id === 'characters') renderCharacters();
  if(id === 'shop') renderShop();
  if(id === 'money') renderMoney();
  if(id === 'tracker') renderTracker();
  if(id === 'trios') renderTrios();
  if(id === 'updates') renderUpdates();
}

/* ---------- RENDER ---------- */
function renderCharacters(){
  const container = $('#characters');
  container.innerHTML = '<div class="group-title">Personagens</div><div class="small">Clique no cart√£o para ver habilidade e falas (EN / PT)</div><div class="grid" id="charactersGrid" style="margin-top:12px"></div>';
  const grid = $('#charactersGrid');
  grid.innerHTML = '';
  const survivors = characters.filter(c=>c.type === "Sobrevivente");
  const killers = characters.filter(c=>c.type === "Assassino");

  if(survivors.length){
    const block = document.createElement('div'); block.className='card'; block.style.gridColumn = '1 / -1';
    block.innerHTML = `<div style="font-weight:900">Sobreviventes</div><div class="small" style="margin-top:6px">Personagens que defendem e ajudam.</div>`;
    grid.appendChild(block);
    survivors.forEach(ch=> grid.appendChild(createCharCard(ch)));
  }
  if(killers.length){
    const block = document.createElement('div'); block.className='card'; block.style.gridColumn = '1 / -1';
    block.innerHTML = `<div style="font-weight:900">Assassinos</div><div class="small" style="margin-top:6px">Personagens cujo objetivo √© ca√ßar.</div>`;
    grid.appendChild(block);
    killers.forEach(ch=> grid.appendChild(createCharCard(ch)));
  }
}
function createCharCard(ch){
  const card = document.createElement('div'); card.className = 'card';
  const header = document.createElement('div'); header.className = 'char-name';
  header.innerHTML = `<div style="font-weight:800">${ch.display}</div><div class="small"><span class="tag ${ch.rarity}">${ch.rarity.toUpperCase()}</span> ‚Ä¢ ${ch.type}</div>`;
  const ability = document.createElement('div'); ability.className = 'char-ability';
  ability.innerHTML = `<strong>Habilidade:</strong> ${ch.ability}<br><strong>EN:</strong> ${ch.phraseEN} &nbsp; <strong>PT:</strong> ${ch.phrasePT}`;
  header.addEventListener('click', ()=> ability.classList.toggle('hidden'));
  card.appendChild(header); card.appendChild(ability);
  return card;
}

/* SHOP rendering (discount only if activeEvent is a 'comemoracao') */
function isCelebrationActive(){
  if(!activeEvent) return false;
  const def = eventDefinitions[activeEvent];
  return def && def.type === 'comemoracao';
}
function renderShop(){
  const area = $('#shop'); area.innerHTML = '<div class="group-title">Loja</div><div class="small">Pre√ßos antigos riscados ‚Üí pre√ßo atual (promo√ß√µes aplicadas)</div>';
  const grid = document.createElement('div'); grid.className = 'grid';
  characters.forEach(ch=>{
    const c = document.createElement('div'); c.className = 'card';
    // display price: base price (ch.price) but apply 50% off only when isCelebrationActive()
    let displayPrice = ch.price;
    let old = ch.oldPrice;
    if(isCelebrationActive()){
      displayPrice = Math.round(ch.price * (1 - eventDefinitions[activeEvent].discount));
    }
    c.innerHTML = `<div style="font-weight:900">${ch.display}</div>
      <div class="small">${ch.type} ‚Ä¢ <span class="tag ${ch.rarity}">${ch.rarity.toUpperCase()}</span></div>
      <div style="margin-top:8px">${ch.ability}</div>
      <div style="margin-top:10px" class="shop-line"><div><span class="old-price">${old}E</span><span class="new-price">${displayPrice}E</span></div><div style="text-align:right">${(activeEvent? ('Evento: '+ (eventDefinitions[activeEvent]?.label||activeEvent)) : '')}</div></div>`;
    grid.appendChild(c);
  });
  area.appendChild(grid);
}

/* MONEY */
function renderMoney(){
  const tbody = $('#moneyTableBody'); tbody.innerHTML = '';
  moneyTable.forEach(row=>{
    const tr = document.createElement('tr'); tr.innerHTML = `<td>${row.action}</td><td>${row.value}</td>`;
    tbody.appendChild(tr);
  });
}

/* TRACKER */
let players = JSON.parse(localStorage.getItem('recall_players') || '[]');
function renderTracker(){
  const area = $('#tracker');
  area.innerHTML = '<div class="group-title">Lista secreta ‚Äî Controle de Personagens</div><div class="small">Protegido por senha.</div><div id="trackerArea" style="margin-top:12px"><div id="loginDiv"><p class="small">Digite a senha:</p><input id="trackerPass" type="password" placeholder="Senha" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)"><button id="trackerLogin" class="event-btn">Entrar</button></div><div id="trackerContent" class="hidden" style="margin-top:12px"><div style="overflow:auto"><table id="playerTable"><thead><tr id="playerHeader"><th>Jogador</th></tr></thead><tbody id="playerBody"></tbody></table></div><div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap"><button id="addPlayer" class="btn">Adicionar Jogador</button><button id="clearPlayers" class="btn">Limpar lista</button><button id="exportPlayers" class="btn danger">Exportar (JSON)</button></div></div></div>';
  buildPlayerHeader();
  document.getElementById('trackerLogin').addEventListener('click', ()=> {
    const v = document.getElementById('trackerPass').value;
    if(v === TRACKER_PASSWORD){
      document.getElementById('loginDiv').style.display = 'none';
      document.getElementById('trackerContent').classList.remove('hidden');
      renderTable();
    } else alert('Senha incorreta!');
  });
  document.getElementById('addPlayer').addEventListener('click', ()=> {
    const name = prompt('Nome do jogador:'); if(!name) return;
    players.push({name, characters:{}}); localStorage.setItem('recall_players', JSON.stringify(players)); renderTable();
  });
  document.getElementById('clearPlayers').addEventListener('click', ()=> {
    if(confirm('Limpar toda a lista local?')){ players=[]; localStorage.setItem('recall_players', JSON.stringify(players)); renderTable(); }
  });
  document.querySelector('.btn.danger')?.addEventListener('click', ()=> {
    const data = JSON.stringify(players,null,2); const blob = new Blob([data],{type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'recall_players.json'; a.click(); URL.revokeObjectURL(url);
  });
}
function buildPlayerHeader(){
  const header = document.getElementById('playerHeader'); header.innerHTML = '<th>Jogador</th>';
  characters.forEach(c=> { const th = document.createElement('th'); th.textContent = c.key; header.appendChild(th); });
}
function renderTable(){
  const tbody = document.getElementById('playerBody'); tbody.innerHTML = '';
  players.forEach((p, idx)=>{
    const tr = document.createElement('tr');
    const tdName = document.createElement('td'); tdName.textContent = p.name; tr.appendChild(tdName);
    characters.forEach(ch=>{
      const td = document.createElement('td'); const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!p.characters[ch.key];
      cb.addEventListener('change', ()=> { players[idx].characters[ch.key] = cb.checked; localStorage.setItem('recall_players', JSON.stringify(players));});
      td.appendChild(cb); tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

/* TRIOS */
function renderTrios(){
  const grid = $('#trioGrid'); grid.innerHTML = '';
  trios.forEach(t=>{
    const card = document.createElement('div'); card.className = 'card';
    const list = t.members.map(m=> `<li>${m}</li>`).join('');
    card.innerHTML = `<div style="font-weight:900">${t.title}</div><div class="small">${t.desc}</div><div style="margin-top:8px"><ul>${list}</ul></div>`;
    grid.appendChild(card);
  });
}

/* UPDATES */
function renderUpdates(){
  const area = $('#updates'); area.innerHTML = '<div class="group-title">Atualiza√ß√µes</div>';
  const list = [
    {title:"V1.3 ‚Äî Halloween & Cael", desc:"Cael (√âPICO) adicionado; promo Halloween pronta; tr√≠ades completas; painel secreto."},
    {title:"V1.2", desc:"Adicionado Liora, Marin e Requiem; melhorias no tracker."},
    {title:"V1.0", desc:"Vers√£o inicial do Recall WI."}
  ];
  list.forEach(u=>{ const block = document.createElement('div'); block.className='card'; block.innerHTML = `<div style="font-weight:900">${u.title}</div><div class="small" style="margin-top:8px">${u.desc}</div>`; area.appendChild(block); });
}

/* ---------- EVENTS PANEL (secret) ---------- */
const secretBtn = document.getElementById('secretBtn');
const secretPanel = document.getElementById('secretPanel');
const unlockBtn = document.getElementById('unlockBtn');
const closeSecret = document.getElementById('closeSecret');

secretBtn.addEventListener('click', ()=> { secretPanel.style.display = secretPanel.style.display === 'block' ? 'none' : 'block'; });
closeSecret.addEventListener('click', ()=> secretPanel.style.display='none');

unlockBtn.addEventListener('click', ()=> {
  const v = document.getElementById('secretPass').value;
  if(v === TRACKER_PASSWORD){
    document.getElementById('secretPass').value = '';
    document.getElementById('eventControls').style.display = 'block';
    // populate tooltips
    document.querySelectorAll('#secretPanel .event-btn').forEach(b=>{
      const ev = b.getAttribute('data-event');
      if(ev && eventDefinitions[ev]) b.title = 'Per√≠odo recomendado: ' + eventDefinitions[ev].rec;
    });
    alert('Painel secreto desbloqueado. Use com cuidado.');
  } else alert('Senha incorreta!');
});

document.getElementById('resetEventBtn').addEventListener('click', ()=> {
  activeEvent = null; localStorage.removeItem('recall_active_event'); localStorage.removeItem('recall_theme_mode'); applyEvent(); renderShop(); updateHeaderEvent(); alert('Evento resetado');
});

/* wiring event buttons */
secretPanel.addEventListener('click', (e)=>{
  const btn = e.target.closest('.event-btn');
  if(!btn) return;
  const ev = btn.getAttribute('data-event');
  if(!ev) return;
  activeEvent = ev;
  localStorage.setItem('recall_active_event', ev);
  localStorage.setItem('recall_theme_mode', ev);
  applyEvent();
  renderShop();
  updateHeaderEvent();
  alert('Evento ativado: ' + (eventDefinitions[ev]?.label || ev));
});

/* apply event visuals / discount logic */
function applyEvent(){
  // visuals: update body background and logo per event
  const logo = document.getElementById('logoBox');
  const label = document.getElementById('activeEventLabel');
  const info = document.getElementById('activeEventInfo');

  if(!activeEvent){
    document.body.style.background = 'linear-gradient(180deg,#0b0d10,#111217)';
    logo.style.background = 'linear-gradient(135deg,var(--accent),var(--purple))';
    label.textContent = 'Nenhum evento';
    label.style.background = 'rgba(255,255,255,0.02)';
    info.textContent = '';
    localStorage.removeItem('recall_theme_mode');
    return;
  }

  const def = eventDefinitions[activeEvent];
  label.textContent = def?.label || activeEvent;
  info.textContent = def?.rec || '';

  // choose visuals per event key
  if(activeEvent === 'halloween'){
    document.body.style.background = `linear-gradient(180deg,var(--halloween-bg-start),var(--halloween-bg-end))`;
    logo.style.background = 'linear-gradient(135deg,var(--orange),#6a1b9a)';
  } else if(activeEvent === 'natal'){
    document.body.style.background = `linear-gradient(180deg,var(--natal-bg-start),var(--natal-bg-end))`;
    logo.style.background = 'linear-gradient(135deg,#0b8f6e,#ff4242)';
  } else if(activeEvent === 'aniversario'){
    document.body.style.background = `linear-gradient(180deg,var(--aniv-bg-start),var(--aniv-bg-end))`;
    logo.style.background = 'linear-gradient(135deg,#ffd700,#ff8a00)';
  } else if(eventDefinitions[activeEvent] && eventDefinitions[activeEvent].type === 'estacao'){
    // lighter seasonal palettes
    if(activeEvent === 'verao'){ document.body.style.background = 'linear-gradient(180deg,#05162b,#052b44)'; logo.style.background = 'linear-gradient(135deg,#ffd166,#ff8a00)'; }
    if(activeEvent === 'primavera'){ document.body.style.background = 'linear-gradient(180deg,#06131b,#0b2b14)'; logo.style.background = 'linear-gradient(135deg,#a0ffb8,#5ce1a1)'; }
    if(activeEvent === 'outono'){ document.body.style.background = 'linear-gradient(180deg,#1b0b00,#2b0f00)'; logo.style.background = 'linear-gradient(135deg,#ffb86b,#ff7b00)'; }
    if(activeEvent === 'inverno'){ document.body.style.background = 'linear-gradient(180deg,#021027,#071a34)'; logo.style.background = 'linear-gradient(135deg,#bfe3ff,#6fb3ff)'; }
  } else {
    // generic event look
    document.body.style.background = 'linear-gradient(180deg,#07121b,#181b2a)';
    logo.style.background = 'linear-gradient(135deg,var(--accent),var(--purple))';
  }
}

/* ---------- TIMER: auto-activate Halloween at 09/11 12:30 local (only if no manual event active) */
function checkAutoActivate(){
  try{
    const now = new Date();
    // determine target year as nearest upcoming (this or next year)
    let year = now.getFullYear();
    const targetThisYear = new Date(year, 10, 9, 12, 30, 0); // Nov 9
    let target = targetThisYear;
    if(now > targetThisYear) {
      target = new Date(year+1,10,9,12,30,0);
    }
    // Activate only if there is NO activeEvent (manual or persisted)
    if(!activeEvent){
      // if it's the exact time or after (during that minute) activate immediately
      if(now >= target && now - target < (1000*60*60*24)){ // within 24h window after target: trigger once
        activeEvent = 'halloween';
        localStorage.setItem('recall_active_event', 'halloween');
        localStorage.setItem('recall_theme_mode', 'halloween');
        applyEvent(); renderShop(); updateHeaderEvent();
      }
    }
  }catch(e){ console.error(e) }
}
checkAutoActivate();

/* ---------- Export: generate a version of index.html with FORCE_GLOBAL_EVENT set ---------- */
function generateExportHTML(forceEventKey){
  // We will produce a copy of this file but with a small header variable FORCE_GLOBAL_EVENT set.
  // For simplicity, create a minimal wrapper replacing the localStorage-based activation with hard-coded FORCE_GLOBAL_EVENT.
  // This exported HTML will be a working standalone copy; user can upload it to GitHub to force the event for all visitors.
  // Build a serialized copy of the HTML with FORCE_GLOBAL_EVENT inserted.
  const htmlTemplate = `<!-- Generated index.html: FORCE_GLOBAL_EVENT = ${forceEventKey ? "'" + forceEventKey + "'" : "null"} -->\n` +
  document.documentElement.outerHTML;
  return htmlTemplate;
}

function downloadExportWithEvent(key){
  const html = generateExportHTML(key);
  const blob = new Blob([html], {type: 'text/html;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  const name = key ? `index_force_${key}.html` : 'index_force_none.html';
  a.download = name;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/* wire export buttons */
document.getElementById('exportGlobalBtn').addEventListener('click', ()=>{
  // quick export: uses the currently active event (if any) as FORCE_GLOBAL_EVENT
  const ev = activeEvent;
  const ok = confirm('Gerar um index.html PRONTO para upload (ir√° for√ßar o evento "' + (ev || 'none') + '" para todos os visitantes). Deseja continuar?');
  if(!ok) return;
  downloadExportWithEvent(ev);
});

document.getElementById('exportGlobalPrompt').addEventListener('click', ()=>{
  const choice = prompt('Digite a chave do evento para for√ßar (ex: halloween, natal, aniversario). Deixe em branco para nenhuma:');
  if(choice === null) return;
  const key = choice.trim() || null;
  if(key && !eventDefinitions[key]) { alert('Evento desconhecido: ' + key); return; }
  downloadExportWithEvent(key);
});

/* ---------- Update header badge + initial UI ---------- */
function updateHeaderEvent(){
  const label = document.getElementById('activeEventLabel');
  const info = document.getElementById('activeEventInfo');
  if(!activeEvent){ label.textContent = 'Nenhum evento'; info.textContent = ''; return; }
  const def = eventDefinitions[activeEvent];
  label.textContent = def?.label || activeEvent;
  info.textContent = def?.rec || '';
}

/* ---------- INIT ---------- */
function init(){
  renderCharacters(); renderShop(); renderMoney(); renderTrios(); renderUpdates();
  // money table
  const tbody = $('#moneyTableBody'); tbody.innerHTML='';
  moneyTable.forEach(r=>{ const tr = document.createElement('tr'); tr.innerHTML = `<td>${r.action}</td><td>${r.value}</td>`; tbody.appendChild(tr); });
  // set event from localStorage if present
  if(activeEvent) applyEvent();
  updateHeaderEvent();
  // wire nav default
  showSection('characters');
  // wire secret panel behavior for event buttons' tooltips (done on unlock)
}
init();

</script>
</body>
</html>
